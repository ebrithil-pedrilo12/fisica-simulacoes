<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>MRUV — Carro acelerando (Exercício 5)</title>
<style>
  :root{
    --bg:#0e1324; --panel:#141a33; --text:#e6ebf2; --muted:#9aa3b2; --accent:#60a5fa; --accent2:#6ee7b7;
    --danger:#ef4444; --good:#22c55e; --shadow:0 10px 30px rgba(0,0,0,.35);
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;background:radial-gradient(1200px 600px at 20% 0%, #171b35 0%, #0f1222 50%, #0b0e1a 100%);color:var(--text);font:16px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
  .wrap{max-width:1280px;margin:28px auto 64px;padding:0 18px}
  h1{margin:0 0 8px;font-size:clamp(22px,3vw,30px)}
  .muted{color:var(--muted)}
  .grid{
    display:grid;
    grid-template-columns:1.45fr 0.55fr; /* mais espaço à esquerda */
    gap:24px;                             /* mais respiro entre colunas */
    align-items:start;
  }
  @media (max-width:1100px){ .grid{grid-template-columns:1fr} }
  .card{background:linear-gradient(180deg,rgba(255,255,255,.05),rgba(255,255,255,.02));border:1px solid rgba(255,255,255,.07);border-radius:14px;box-shadow:var(--shadow);padding:14px}
  .row{display:flex;flex-wrap:wrap;gap:10px;align-items:center}
  .controls{display:grid;grid-template-columns:1fr;gap:10px}
  .field{background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.12);border-radius:10px;padding:10px}
  .field label{display:block;font-size:12px;color:var(--muted);margin-bottom:6px;text-transform:uppercase;letter-spacing:.3px}
  .field input[type="range"]{width:100%}
  .btn{appearance:none;border:1px solid rgba(255,255,255,.14);background:linear-gradient(180deg,#1c2347,#141a36);color:#e8eef7;border-radius:10px;padding:10px 14px;font-weight:600;cursor:pointer}
  .btn:active{transform:translateY(1px) scale(.99)}
  .btn.ghost{background:transparent;color:#cbd5e1}
  .btn.green{background:linear-gradient(180deg,#1e7046,#175c39);border-color:#2bb673}
  .btn.red{background:linear-gradient(180deg,#7a1f1f,#5d1717);border-color:#b43b3b}
  .pill{display:inline-flex;align-items:center;gap:8px;background:rgba(96,165,250,.12);border:1px solid rgba(96,165,250,.25);color:#bfdbfe;padding:8px 12px;border-radius:999px;font-size:14px}
  .kbd{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono";background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.15);padding:1px 6px;border-radius:6px;font-size:12px;color:#e5e7eb}
  /* palco */
  .stage{background:linear-gradient(180deg,#0b101e,#0f1526);border:1px solid rgba(255,255,255,.08);border-radius:12px;padding:12px}
  .road{position:relative;height:170px;background:linear-gradient(180deg,#303744,#242b36);border-radius:10px;overflow:hidden}
  .lane{position:absolute;left:0;right:0;height:2px;background:repeating-linear-gradient(90deg, rgba(255,255,255,.6) 0 28px, transparent 28px 56px);top:50%;transform:translateY(-50%);opacity:.5}
  .car{position:absolute;bottom:18px;left:0;width:84px;height:38px;background:linear-gradient(180deg,#60a5fa,#3b82f6);border:2px solid rgba(255,255,255,.35);border-radius:10px 10px 8px 8px;box-shadow:0 6px 18px rgba(0,0,0,.4)}
  .wheel{position:absolute;bottom:-8px;width:18px;height:18px;background:#111;border-radius:50%;border:2px solid #444}
  .wheel.left{left:12px} .wheel.right{right:14px}
  .finish{position:absolute;right:0;top:0;bottom:0;width:8px;background:repeating-linear-gradient(0deg,#ddd 0 10px,#111 10px 20px)}
  /* gráficos */
  .charts{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:14px;margin-top:12px}
  @media (max-width:900px){ .charts{grid-template-columns:1fr} }
  .chartWrap{background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.08);border-radius:10px;padding:8px}
  canvas{display:block;width:100%;height:260px;border-radius:8px}
  .formula{font-size:14px;color:#dbe7ff}
  .muted small{font-size:12px}
  .rightPanel{position:sticky; top:12px} /* “cola” a coluna direita */
  .row.gap8{gap:8px}
  .hint{font-size:12px;color:#aab4c3}
</style>
</head>
<body>
<div class="wrap">
  <h1>MRUV — Carro acelerando (Exercício 5)</h1>
  <div class="muted">Use <span class="kbd">Espaço</span> iniciar/pausar · <span class="kbd">R</span> resetar · <span class="kbd">E</span> aplicar valores do enunciado</div>

  <div class="grid" style="margin-top:14px">
    <!-- Esquerda: palco + gráficos -->
    <section class="card stage">
      <div class="row" style="justify-content:space-between; margin-bottom:8px">
        <span class="pill">t: <strong id="tLabel">0.00 s</strong></span>
        <span class="pill">v: <strong id="vLabel">0.00 m/s</strong> (<strong id="vKmhLabel">0.00 km/h</strong>)</span>
        <span class="pill">s: <strong id="sLabel">0.00 m</strong></span>
        <span class="pill">a: <strong id="aLabel">0.00 m/s²</strong></span>
      </div>

      <div class="road" id="road">
        <div class="lane"></div>
        <div id="car" class="car" aria-label="carro">
          <div class="wheel left"></div>
          <div class="wheel right"></div>
        </div>
        <div class="finish" id="finish"></div>
      </div>

      <div class="charts">
        <div class="chartWrap"><canvas id="vt" aria-label="gráfico velocidade-tempo"></canvas></div>
        <div class="chartWrap"><canvas id="st" aria-label="gráfico posição-tempo"></canvas></div>
      </div>
    </section>

    <!-- Direita: controles e fórmulas -->
    <aside class="card rightPanel">
      <div class="controls">
        <div class="field">
          <label>Velocidade inicial v₀ (m/s)</label>
          <input type="range" id="v0" min="0" max="30" step="0.1" value="0">
          <div class="row"><span class="muted">Atual:</span><strong id="v0Val">0.0</strong> m/s (<span id="v0Kmh">0.0</span> km/h)</div>
        </div>
        <div class="field">
          <label>Aceleração a (m/s²)</label>
          <input type="range" id="a" min="0" max="6" step="0.01" value="3.333">
          <div class="row"><span class="muted">Atual:</span><strong id="aVal">3.333</strong> m/s²</div>
        </div>
        <div class="field">
          <label>Tempo total (s)</label>
          <input type="range" id="T" min="4" max="30" step="0.5" value="12">
          <div class="row"><span class="muted">Atual:</span><strong id="TVal">12.0</strong> s</div>
        </div>
        <div class="field">
          <label>Comprimento da pista (m)</label>
          <input type="range" id="L" min="20" max="1000" step="5" value="300">
          <div class="row"><span class="muted">Atual:</span><strong id="LVal">300</strong> m</div>
          <div class="hint">Dica: com <b>pista automática</b> desligada, você controla aqui.</div>
        </div>
        <div class="field">
          <label>Pista automática</label>
          <div class="row gap8">
            <input type="checkbox" id="autoTrack" checked>
            <span class="muted">Ajusta o comprimento da pista para caber <i>s(T)</i> com 10% de folga.</span>
          </div>
        </div>
      </div>

      <div class="row" style="margin-top:10px; gap:8px">
        <button class="btn green" id="playBtn">Iniciar</button>
        <button class="btn" id="pauseBtn">Pausar</button>
        <button class="btn red" id="resetBtn">Resetar</button>
        <button class="btn ghost" id="exerciseBtn">Valores do enunciado</button>
      </div>

      <div style="margin-top:12px" class="formula">
        <div><b>Fórmulas</b></div>
        <div>v(t) = v₀ + a·t</div>
        <div>s(t) = s₀ + v₀·t + ½·a·t²</div>
        <div style="margin-top:6px"><small class="muted">Enunciado: v₀=0, v(12s)=40 m/s (144 km/h) ⇒ a ≈ 3,33 m/s².</small></div>
      </div>
    </aside>
  </div>
</div>

<script>
  // ===== Referências =====
  const road = document.getElementById('road');
  const carEl = document.getElementById('car');
  const finishEl = document.getElementById('finish');

  const v0Slider = document.getElementById('v0');
  const aSlider  = document.getElementById('a');
  const TSlider  = document.getElementById('T');
  const LSlider  = document.getElementById('L');
  const autoTrack = document.getElementById('autoTrack');

  const v0Val = document.getElementById('v0Val');
  const v0Kmh = document.getElementById('v0Kmh');
  const aVal  = document.getElementById('aVal');
  const TVal  = document.getElementById('TVal');
  const LVal  = document.getElementById('LVal');

  const tLabel = document.getElementById('tLabel');
  const vLabel = document.getElementById('vLabel');
  const vKmhLabel = document.getElementById('vKmhLabel');
  const sLabel = document.getElementById('sLabel');
  const aLabel = document.getElementById('aLabel');

  const playBtn = document.getElementById('playBtn');
  const pauseBtn = document.getElementById('pauseBtn');
  const resetBtn = document.getElementById('resetBtn');
  const exerciseBtn = document.getElementById('exerciseBtn');

  const vt = document.getElementById('vt');
  const st = document.getElementById('st');
  const ctxV = vt.getContext('2d');
  const ctxS = st.getContext('2d');

  // ===== Estado =====
  let running = false;
  let t = 0;         // tempo
  let v0 = +v0Slider.value; // m/s
  let a  = +aSlider.value;  // m/s²
  let T  = +TSlider.value;  // s
  let L  = +LSlider.value;  // m
  let s0 = 0;        // m
  let s  = 0;        // m
  let lastTs = null;

  function mpsToKmh(x){ return x*3.6; }

  // ===== Canvas responsivo =====
  function resizeCanvases(){
    [vt, st].forEach(canvas=>{
      const parent = canvas.parentElement.getBoundingClientRect();
      const dpr = window.devicePixelRatio || 1;
      canvas.width = Math.floor(parent.width * dpr);
      canvas.height = Math.floor(260 * dpr);
      canvas.style.width = parent.width + "px";
      canvas.style.height = "260px";
      (canvas === vt ? drawAxesV : drawAxesS)();
    });
  }
  window.addEventListener('resize', ()=>{ resizeCanvases(); redrawSeries(); });

  function pxPerM(){ return (road.clientWidth - 110) / L; } // 110px margem até a chegada
  function setFinish(){ finishEl.style.right = "0px"; }

  function stateFromSliders(){
    v0 = +v0Slider.value;
    a  = +aSlider.value;
    T  = +TSlider.value;

    // pista automática: L -> s(T)*1.1 (com limites)
    if (autoTrack.checked){
      const sT = s0 + v0*T + 0.5*a*T*T;
      L = Math.max(20, Math.min(1000, Math.ceil(sT*1.1)));
      LSlider.value = L;
    } else {
      L = +LSlider.value;
    }

    // labels
    v0Val.textContent = v0.toFixed(1);
    v0Kmh.textContent = mpsToKmh(v0).toFixed(1);
    aVal.textContent  = a.toFixed(3);
    TVal.textContent  = T.toFixed(1);
    LVal.textContent  = Math.round(L);

    aLabel.textContent = a.toFixed(2) + " m/s²";
    setFinish();
  }

  // ===== Física =====
  function physicsStep(dt){
    t += dt;
    if (t > T) { t = T; running = false; }
    const v = v0 + a*t;
    s = s0 + v0*t + 0.5*a*t*t;

    // UI
    tLabel.textContent = t.toFixed(2) + " s";
    vLabel.textContent = v.toFixed(2) + " m/s";
    vKmhLabel.textContent = mpsToKmh(v).toFixed(2) + " km/h";
    sLabel.textContent = s.toFixed(2) + " m";

    // movimento do carro (não ultrapassa a chegada)
    const x = Math.min(s, L);
    carEl.style.left = (x * pxPerM()) + "px";

    // gráficos
    pushPlot(t, v, s);
  }

  // ===== Gráficos =====
  const plot = { t:[], v:[], s:[] };

  function clearAll(ctx){ ctx.clearRect(0,0,ctx.canvas.width,ctx.canvas.height); }

  function drawAxes(ctx, ylabel, xlabel){
    clearAll(ctx);
    const cw = ctx.canvas.width, ch = ctx.canvas.height;
    const dpr = window.devicePixelRatio || 1;
    const x0 = 50*dpr, y0 = 20*dpr, w = (cw - 80*dpr), h = (ch - 70*dpr);

    ctx.save();
    ctx.strokeStyle = "rgba(255,255,255,.25)";
    ctx.lineWidth = 1*dpr;
    ctx.strokeRect(x0, y0, w, h);
    ctx.fillStyle = "rgba(230,235,242,.9)";
    ctx.font = (12*dpr) + "px ui-monospace, monospace";
    ctx.fillText(xlabel, x0 + w/2 - 20*dpr, y0 + h + 30*dpr);
    ctx.save();
    ctx.translate(16*dpr, y0 + h/2 + 20*dpr);
    ctx.rotate(-Math.PI/2);
    ctx.fillText(ylabel, 0, 0);
    ctx.restore();
    ctx.restore();
  }
  function drawAxesV(){ drawAxes(ctxV, "v (m/s)", "t (s)"); }
  function drawAxesS(){ drawAxes(ctxS, "s (m)", "t (s)"); }

  function pushPlot(tNow, vNow, sNow){
    plot.t.push(tNow); plot.v.push(vNow); plot.s.push(sNow);
    redrawSeries();
  }

  function redrawSeries(){
    const tMax = Math.max(T, 1);
    drawAxesV(); drawAxesS();
    drawSeries(ctxV, plot.t, plot.v, 0, tMax);
    drawSeries(ctxS, plot.t, plot.s, 0, tMax);
  }

  function drawSeries(ctx, xs, ys, xmin, xmax){
    if (xs.length < 2) return;
    const dpr = window.devicePixelRatio || 1;
    const cw = ctx.canvas.width, ch = ctx.canvas.height;
    const x0 = 50*dpr, y0 = 20*dpr, w = (cw - 80*dpr), h = (ch - 70*dpr);

    const ymin = Math.min(...ys, 0);
    const ymax = Math.max(...ys, ys[ys.length-1]||0, 1);

    ctx.save();
    ctx.beginPath();
    for (let i=0;i<xs.length;i++){
      const x = x0 + ((xs[i]-xmin)/(xmax-xmin)) * w;
      const y = y0 + h - ((ys[i]-ymin)/(ymax-ymin || 1)) * h;
      if (i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
    }
    ctx.lineWidth = 2*dpr;
    ctx.strokeStyle = "rgba(110,231,183,.9)";
    ctx.stroke();
    ctx.restore();
  }

  // ===== Loop =====
  function frame(ts){
    if (lastTs == null) lastTs = ts;
    const dt = Math.min(0.05, (ts - lastTs)/1000); // cap 50ms
    lastTs = ts;
    if (running){
      physicsStep(dt);
      requestAnimationFrame(frame);
    }
  }

  function play(){ if (!running && t < T){ running = true; lastTs = null; requestAnimationFrame(frame); } }
  function pause(){ running = false; }
  function reset(){
    running = false; t = 0; s = 0; lastTs = null;
    carEl.style.left = "0px";
    tLabel.textContent = "0.00 s";
    vLabel.textContent = v0.toFixed(2) + " m/s";
    vKmhLabel.textContent = mpsToKmh(v0).toFixed(2) + " km/h";
    sLabel.textContent = "0.00 m";
    plot.t.length = plot.v.length = plot.s.length = 0;
    resizeCanvases(); // redesenha eixos
  }

  // ===== Eventos =====
  function onParamsChanged(){
    stateFromSliders();
    reset();
  }
  [v0Slider,aSlider,TSlider,LSlider,autoTrack].forEach(sl=> sl.addEventListener('input', onParamsChanged));

  playBtn.addEventListener('click', play);
  pauseBtn.addEventListener('click', pause);
  resetBtn.addEventListener('click', reset);
  exerciseBtn.addEventListener('click', ()=>{
    v0Slider.value = 0;
    aSlider.value  = (40/12).toFixed(3); // ~3.333
    TSlider.value  = 12;
    // com pista automática, L ajusta; se manual, define 300 m
    if (!autoTrack.checked) LSlider.value = 300;
    onParamsChanged();
  });

  window.addEventListener('keydown', (e)=>{
    if (e.code === 'Space'){ e.preventDefault(); running ? pause() : play(); }
    else if (e.key.toLowerCase()==='r'){ reset(); }
    else if (e.key.toLowerCase()==='e'){ exerciseBtn.click(); }
  });

  // init
  stateFromSliders();
  resizeCanvases();
  reset();
</script>
</body>
</html>
